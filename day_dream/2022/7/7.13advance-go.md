# 技术
## advance-go
90分钟， 下次从这里开始: https://books.studygolang.com/advanced-go-programming-book/ch6-cloud/ch6-05-load-balance.html
### 延时任务系统
#### 定时任务概览
我们在做系统时，很多时候是处理实时的任务，请求来了马上就处理，然后立刻给用户以反馈。但有时也会遇到非实时的任务，比如确定的时间点发布重要公告。或者需要在用户做了一件事情的X分钟/Y小时后，对其特定动作，比如通知、发券等等。

如果业务规模比较小，有时我们也可以通过数据库配合轮询来对这种任务进行简单处理，但上了规模的公司，自然会寻找更为普适的解决方案来解决这一类问题。

一般有两种思路来解决这个问题：

1. 实现一套类似crontab的分布式定时任务管理系统。
2. 实现一个支持定时发送消息的消息队列。

#### 定时任务调用
当这些定时任务被触发之后需要通知用户侧，有两种思路：

1. 将任务被触发的信息封装为一条消息，发往消息队列，由用户侧对消息队列进行监听。
2. 对用户预先配置的回调函数进行调用。

两种方案各有优缺点，如果采用1，那么如果消息队列出故障会导致整个系统不可用，当然，现在的消息队列一般也会有自身的高可用方案，大多数时候我们不用担心这个问题。其次一般业务流程中间走消息队列的话会导致延时增加，定时任务若必须在触发后的几十毫秒到几百毫秒内完成，那么采用消息队列就会有一定的风险。**如果采用2，会加重定时任务系统的负担。我们知道，单机的定时器执行时最害怕的就是回调函数执行时间过长，这样会阻塞后续的任务执行。在分布式场景下，这种忧虑依然是适用的。一个不负责任的业务回调可能就会直接拖垮整个定时任务系统。（之前做过python模块调用系统接口，没有做超时处理，导致整个任务系统出现卡死）**所以我们还要考虑在回调的基础上增加经过测试的超时时间设置，并且对由用户填入的超时时间做慎重的审核。

#### 数据再平衡和幂等考量
advance-go这本书里面写的是参考Elasticsearch的数据分布设计，每份任务数据都有多个副本。感觉好像不太方便。之前我在前公司做的这种任务，使用的是hash环的数据再平衡方式

**对于任务幂等，则是通过完成的任务迁移到新的对象桶来实现的**

### 分布式搜索引擎
在CRM或客服类系统中，常常有根据关键字进行搜索的需求，大型互联网公司每天会接收数以万计的用户投诉。而考虑到事件溯源，用户的投诉至少要存2~3年。又是千万级甚至上亿的数据。根据关键字进行一次like查询，可能整个MySQL就直接挂掉了。

**这时候我们就需要搜索引擎来救场了。**

#### 查询 DSL
看了Elasticsearch中的json语法，就瞬间理解了之前见到的bleve的搜索语法了...

感想:
**所以还是要多看书啊，需要把基础知识巩固牢固，这样才能在工作上效率更好，更好地完成任务，这也是为啥一个高级程序员顶得上很多个初级程序员的道理(在没有规范化生产的地方，甚至抵得上无数个，因为没有规范化生产的话，初级程序员越多，反而导致工作越乱)**  

**平时多看书修炼，用几年的时间去巩固基础知识，然后花大概10年成为一个高级hacker，加油**

#### 索引系统使用注意点
使用es作为数据库使用时，**需要注意，因为es有索引合并的操作，所以数据插入到es中到可以查询的到需要一段时间（由es的refresh_interval决定）**。所以千万不要把es当成强一致的关系型数据库来使用。


# 锻炼
30分钟

早上: 60仰卧起坐，45两板凳的俯卧撑

散步

# 总结
加2自信币和2自信点

摘要今天较大的心得感想:
> 看了Elasticsearch中的json语法，就瞬间理解了之前见到的bleve的搜索语法了...
感想:
**所以还是要多看书啊，需要把基础知识巩固牢固，这样才能在工作上效率更好，更好地完成任务，这也是为啥一个高级程序员顶得上很多个初级程序员的道理(在没有规范化生产的地方，甚至抵得上无数个，因为没有规范化生产的话，初级程序员越多，反而导致工作越乱)**  
**平时多看书修炼，用几年的时间去巩固基础知识，然后花大概10年成为一个高级hacker，加油**